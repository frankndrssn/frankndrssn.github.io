<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link href="coqdoc.css" rel="stylesheet" type="text/css" />
<title>Induction in Coq</title>
</head>

<body>

<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Induction in Coq</h1>

<div class="code">
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Lia</span>.<br/>
</div>

<div class="doc">
<a id="lab1"></a><h1 class="section">Mathematical induction</h1>

</div>
<div class="code">
<span class="id" title="keyword">Section</span> <span class="id" title="keyword">Induction</span>.<br/>

<br/>
</div>

<div class="doc">
Every inductive type admits an induction principle (elimination principle).
 Coq automatically generates an induction principle whenever an inductive type
 is defined. 
</div>
<div class="code">
<span class="id" title="keyword">Print</span> <span class="id" title="var">nat</span>.<br/>
<span class="id" title="keyword">Check</span> <span class="id" title="var">nat_ind</span>.<br/>
<span class="comment">(*&nbsp;<span class="inlinecode"><span class="id" title="var">nat_ind</span></span> <span class="inlinecode">:</span>
      <span class="inlinecode"><span class="id" title="keyword">∀</span></span> <span class="inlinecode"><span class="id" title="var">P</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">nat</span></span> <span class="inlinecode">→</span> <span class="inlinecode"><span class="id" title="keyword">Prop</span>,</span>
      <span class="inlinecode"><span class="id" title="var">P</span></span> <span class="inlinecode">0</span> <span class="inlinecode">→</span>
      <span class="inlinecode">(<span class="id" title="keyword">∀</span></span> <span class="inlinecode"><span class="id" title="var">n</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">nat</span>,</span> <span class="inlinecode"><span class="id" title="var">P</span></span> <span class="inlinecode"><span class="id" title="var">n</span></span> <span class="inlinecode">→</span> <span class="inlinecode"><span class="id" title="var">P</span></span> <span class="inlinecode">(<span class="id" title="var">S</span></span> <span class="inlinecode"><span class="id" title="var">n</span>))</span> <span class="inlinecode">→</span>
      <span class="inlinecode"><span class="id" title="keyword">∀</span></span> <span class="inlinecode"><span class="id" title="var">n</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">nat</span>,</span> <span class="inlinecode"><span class="id" title="var">P</span></span> <span class="inlinecode"><span class="id" title="var">n</span></span>&nbsp;*)</span><br/>

<br/>
</div>

<div class="doc">
We can use the induction principle to define various operations on <span class="inlinecode"><span class="id" title="var">nat</span></span>,
    e.g., addition. Here, we need to use <span class="inlinecode"><span class="id" title="var">nat_rec</span></span> for a technical reason
    that's not important for now. 
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <span class="id" title="var">add_ind</span> : <span class="id" title="var">nat</span> → <span class="id" title="var">nat</span> → <span class="id" title="var">nat</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">nat_rec</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <span class="id" title="var">n</span> ⇒ <span class="id" title="var">nat</span> → <span class="id" title="var">nat</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <span class="id" title="var">x</span> ⇒ <span class="id" title="var">x</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> <span class="id" title="var">f</span> <span class="id" title="var">x</span> ⇒ <span class="id" title="var">S</span> (<span class="id" title="var">f</span> <span class="id" title="var">x</span>)).<br/>

<br/>
</div>

<div class="doc">
<span class="inlinecode"><span class="id" title="var">add_ind</span></span> looks like magic. It's difficult to use the induction principle
    directly, so Coq allows definition by <i>pattern matching</i>. 
</div>
<div class="code">
<span class="id" title="keyword">Print</span> "+".<br/>
<span class="comment">(*&nbsp;<span class="inlinecode"><span class="id" title="var">Nat.add</span></span> <span class="inlinecode">=</span> 
      <span class="inlinecode"><span class="id" title="keyword">fix</span></span> <span class="inlinecode"><span class="id" title="var">add</span></span> <span class="inlinecode">(<span class="id" title="var">n</span></span> <span class="inlinecode"><span class="id" title="var">m</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">nat</span>)</span> <span class="inlinecode">{<span class="id" title="keyword">struct</span></span> <span class="inlinecode"><span class="id" title="var">n</span>}</span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">nat</span></span> <span class="inlinecode">:=</span>
      <span class="inlinecode"><span class="id" title="keyword">match</span></span> <span class="inlinecode"><span class="id" title="var">n</span></span> <span class="inlinecode"><span class="id" title="keyword">with</span></span>
      <span class="inlinecode">|</span> <span class="inlinecode">0</span> <span class="inlinecode">⇒</span> <span class="inlinecode"><span class="id" title="var">m</span></span>
      <span class="inlinecode">|</span> <span class="inlinecode"><span class="id" title="var">S</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> <span class="inlinecode">⇒</span> <span class="inlinecode"><span class="id" title="var">S</span></span> <span class="inlinecode">(<span class="id" title="var">add</span></span> <span class="inlinecode"><span class="id" title="var">p</span></span> <span class="inlinecode"><span class="id" title="var">m</span>)</span>
      <span class="inlinecode"><span class="id" title="keyword">end</span></span>
      <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">nat</span></span> <span class="inlinecode">→</span> <span class="inlinecode"><span class="id" title="var">nat</span></span> <span class="inlinecode">→</span> <span class="inlinecode"><span class="id" title="var">nat</span></span>&nbsp;*)</span><br/>

<br/>
</div>

<div class="doc">
These two functions are equivalent in terms of what they compute. We can use
    induction to prove this fact. To use induction, we need to supply a
    <i>motive</i> <span class="inlinecode"><span class="id" title="var">P</span></span>. Here, <span class="inlinecode"><span class="id" title="var">P</span></span> <span class="inlinecode"><span class="id" title="var">n</span></span> <span class="inlinecode">:=</span> <span class="inlinecode"><span class="id" title="keyword">∀</span></span> <span class="inlinecode"><span class="id" title="var">m</span>,</span> <span class="inlinecode"><span class="id" title="var">add_ind</span></span> <span class="inlinecode"><span class="id" title="var">n</span></span> <span class="inlinecode"><span class="id" title="var">m</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">n</span></span> <span class="inlinecode">+</span> <span class="inlinecode"><span class="id" title="var">m</span></span> is a reasonable
    choice. 
</div>
<div class="code">
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">add_ind_eqv_add</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">n</span> <span class="id" title="var">m</span>, <span class="id" title="var">add_ind</span> <span class="id" title="var">n</span> <span class="id" title="var">m</span> = <span class="id" title="var">n</span> + <span class="id" title="var">m</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">set</span> (<span class="id" title="var">P</span> := <span class="id" title="keyword">fun</span> <span class="id" title="var">n</span> ⇒ <span class="id" title="keyword">∀</span> <span class="id" title="var">m</span>, <span class="id" title="var">add_ind</span> <span class="id" title="var">n</span> <span class="id" title="var">m</span> = <span class="id" title="var">n</span> + <span class="id" title="var">m</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<span class="id" title="var">nat_ind</span> <span class="id" title="var">P</span>); <span class="id" title="tactic">unfold</span> <span class="id" title="var">P</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">n</span> <span class="id" title="var">IHn</span> <span class="id" title="var">m</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHn</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
We can also choose <span class="inlinecode"><span class="id" title="var">P</span></span> <span class="inlinecode"><span class="id" title="var">n</span></span> <span class="inlinecode">:=</span> <span class="inlinecode"><span class="id" title="var">add_ind</span></span> <span class="inlinecode"><span class="id" title="var">n</span></span> <span class="inlinecode"><span class="id" title="var">m</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">n</span></span> <span class="inlinecode">+</span> <span class="inlinecode"><span class="id" title="var">m</span></span> if <span class="inlinecode"><span class="id" title="var">m</span></span> is already in the
    context. 
</div>
<div class="code">
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">add_ind_eqv_add'</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">n</span> <span class="id" title="var">m</span>, <span class="id" title="var">add_ind</span> <span class="id" title="var">n</span> <span class="id" title="var">m</span> = <span class="id" title="var">n</span> + <span class="id" title="var">m</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">n</span> <span class="id" title="var">m</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">set</span> (<span class="id" title="var">P</span> := <span class="id" title="keyword">fun</span> <span class="id" title="var">n</span> ⇒ <span class="id" title="var">add_ind</span> <span class="id" title="var">n</span> <span class="id" title="var">m</span> = <span class="id" title="var">n</span> + <span class="id" title="var">m</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<span class="id" title="var">nat_ind</span> <span class="id" title="var">P</span>); <span class="id" title="tactic">unfold</span> <span class="id" title="var">P</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">n'</span> <span class="id" title="var">IHn'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">destruct</span> <span class="id" title="var">IHn'</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Note that the induction hypothesis in <span class="inlinecode"><span class="id" title="var">add_ind_eqv_add'</span></span> is
    <span class="inlinecode"><span class="id" title="var">add_ind</span></span> <span class="inlinecode"><span class="id" title="var">n'</span></span> <span class="inlinecode"><span class="id" title="var">m</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">n'</span></span> <span class="inlinecode">+</span> <span class="inlinecode"><span class="id" title="var">m</span></span>, which is weaker than the induction hypothesis in
    <span class="inlinecode"><span class="id" title="var">add_ind_eqv_add</span></span> (<span class="inlinecode"><span class="id" title="keyword">∀</span></span> <span class="inlinecode"><span class="id" title="var">m</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">nat</span>,</span> <span class="inlinecode"><span class="id" title="var">add_ind</span></span> <span class="inlinecode"><span class="id" title="var">n</span></span> <span class="inlinecode"><span class="id" title="var">m</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">n</span></span> <span class="inlinecode">+</span> <span class="inlinecode"><span class="id" title="var">m</span></span>). The proof goes through
    because we do not need the extra generality on <span class="inlinecode"><span class="id" title="var">m</span></span> in this case, but
    sometimes the extra generality is the key to proving the given theorem. 
<div class="paragraph"> </div>

 Coq has the <span class="inlinecode"><span class="id" title="tactic">induction</span></span> tactic that automatically finds a motive for us. It
    also does a number of boring steps such as <span class="inlinecode"><span class="id" title="tactic">intros</span></span> for us. Compare the
    induction hypotheses in the following two proofs. 
</div>
<div class="code">
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">add_ind_eqv_add_tactic</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">n</span> <span class="id" title="var">m</span>, <span class="id" title="var">add_ind</span> <span class="id" title="var">n</span> <span class="id" title="var">m</span> = <span class="id" title="var">n</span> + <span class="id" title="var">m</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">n</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">m</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHn</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">add_ind_eqv_add_tactic'</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">n</span> <span class="id" title="var">m</span>, <span class="id" title="var">add_ind</span> <span class="id" title="var">n</span> <span class="id" title="var">m</span> = <span class="id" title="var">n</span> + <span class="id" title="var">m</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">n</span> <span class="id" title="var">m</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">n</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">destruct</span> <span class="id" title="var">IHn</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Thus, we must be conscious of what we <span class="inlinecode"><span class="id" title="tactic">intros</span></span> into the context before
    <span class="inlinecode"><span class="id" title="tactic">induction</span></span>. 
<div class="paragraph"> </div>

 The successor <span class="inlinecode"><span class="id" title="var">S</span></span> is equivalent to adding 1. 
</div>
<div class="code">
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">succ_add_1</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">n</span>, <span class="id" title="var">S</span> <span class="id" title="var">n</span> = 1 + <span class="id" title="var">n</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">easy</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
This simple proof does not work when we state the theorem slightly
    differently. 
</div>
<div class="code">
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">succ_add_1'</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">n</span>, <span class="id" title="var">S</span> <span class="id" title="var">n</span> = <span class="id" title="var">n</span> + 1.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">n</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Abort</span>.<br/>

<br/>
</div>

<div class="doc">
The reason is that <span class="inlinecode">+</span> is recursive on the first argument. <span class="inlinecode"><span class="id" title="var">n</span></span> <span class="inlinecode">+</span> <span class="inlinecode">1</span> is
    stuck because we have no computation rules to handle <span class="inlinecode"><span class="id" title="var">n</span></span>, whereas <span class="inlinecode">1</span> <span class="inlinecode">+</span> <span class="inlinecode"><span class="id" title="var">n</span></span>
    is <span class="inlinecode">(<span class="id" title="var">S</span></span> <span class="inlinecode">0)</span> <span class="inlinecode">+</span> <span class="inlinecode"><span class="id" title="var">n</span></span> and we know how to compute this term: this computes to
    <span class="inlinecode"><span class="id" title="var">S</span></span> <span class="inlinecode">(0</span> <span class="inlinecode">+</span> <span class="inlinecode"><span class="id" title="var">n</span>)</span>, which then computes to <span class="inlinecode"><span class="id" title="var">S</span></span> <span class="inlinecode"><span class="id" title="var">n</span></span>. But, we know that <span class="inlinecode"><span class="id" title="var">n</span></span> must be
    either <span class="inlinecode">0</span> or <span class="inlinecode"><span class="id" title="var">S</span></span> <span class="inlinecode"><span class="id" title="var">n'</span></span> for some <span class="inlinecode"><span class="id" title="var">n'</span></span> because <span class="inlinecode"><span class="id" title="var">nat</span></span> is inductively defined by
    these two constructors. We can use induction to do this kind of case
    analysis. Sometimes the induction hypothesis is not useful. We can use
    <span class="inlinecode"><span class="id" title="tactic">destruct</span></span> instead of <span class="inlinecode"><span class="id" title="tactic">induction</span></span> in those cases. 
</div>
<div class="code">
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">succ_add_1'</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">n</span>, <span class="id" title="var">S</span> <span class="id" title="var">n</span> = <span class="id" title="var">n</span> + 1.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">n</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">destruct</span> <span class="id" title="var">IHn</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
We can now prove various facts about addition. 
<div class="paragraph"> </div>

 <span class="inlinecode"><span class="id" title="var">add_comm</span></span> is an example of why we need to be conscious of what we <span class="inlinecode"><span class="id" title="tactic">intros</span></span>
    into the context. Consider the following attempt. 
<div class="paragraph"> </div>

 Addition is commutative. 
</div>
<div class="code">
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">add_comm</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">n</span> <span class="id" title="var">m</span>, <span class="id" title="var">n</span> + <span class="id" title="var">m</span> = <span class="id" title="var">m</span> + <span class="id" title="var">n</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">n</span> <span class="id" title="var">m</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">n</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">induction</span> <span class="id" title="var">m</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">destruct</span> <span class="id" title="var">IHm</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">induction</span> <span class="id" title="var">m</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">admit</span>.<br/>
<span class="id" title="keyword">Abort</span>.<br/>

<br/>
</div>

<div class="doc">
Just before the second <span class="inlinecode"><span class="id" title="tactic">induction</span></span> <span class="inlinecode"><span class="id" title="var">m</span></span>, the context contains a hypothesis
    <span class="inlinecode"><span class="id" title="var">IHn</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">n</span></span> <span class="inlinecode">+</span> <span class="inlinecode"><span class="id" title="var">m</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">m</span></span> <span class="inlinecode">+</span> <span class="inlinecode"><span class="id" title="var">n</span></span>. Since <span class="inlinecode"><span class="id" title="var">m</span></span> appears free in this hypothesis, the
    <span class="inlinecode"><span class="id" title="tactic">induction</span></span> tactic has to generate the motive
    <span class="inlinecode"><span class="id" title="var">P</span></span> <span class="inlinecode"><span class="id" title="var">m</span></span> <span class="inlinecode">:=</span> <span class="inlinecode"><span class="id" title="var">n</span></span> <span class="inlinecode">+</span> <span class="inlinecode"><span class="id" title="var">m</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">m</span></span> <span class="inlinecode">+</span> <span class="inlinecode"><span class="id" title="var">n</span></span> <span class="inlinecode">→</span> <span class="inlinecode"><span class="id" title="var">S</span></span> <span class="inlinecode"><span class="id" title="var">n</span></span> <span class="inlinecode">+</span> <span class="inlinecode"><span class="id" title="var">m</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">m</span></span> <span class="inlinecode">+</span> <span class="inlinecode"><span class="id" title="var">S</span></span> <span class="inlinecode"><span class="id" title="var">n</span></span>. So, the induction hypothesis is
    <span class="inlinecode"><span class="id" title="var">n</span></span> <span class="inlinecode">+</span> <span class="inlinecode"><span class="id" title="var">m</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">m</span></span> <span class="inlinecode">+</span> <span class="inlinecode"><span class="id" title="var">n</span></span> <span class="inlinecode">→</span> <span class="inlinecode"><span class="id" title="var">S</span></span> <span class="inlinecode"><span class="id" title="var">n</span></span> <span class="inlinecode">+</span> <span class="inlinecode"><span class="id" title="var">m</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">m</span></span> <span class="inlinecode">+</span> <span class="inlinecode"><span class="id" title="var">S</span></span> <span class="inlinecode"><span class="id" title="var">n</span></span>. 
<div class="paragraph"> </div>

 To rewrite with <span class="inlinecode"><span class="id" title="var">IHm</span></span>, we need to prove <span class="inlinecode"><span class="id" title="var">n</span></span> <span class="inlinecode">+</span> <span class="inlinecode"><span class="id" title="var">m</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">m</span></span> <span class="inlinecode">+</span> <span class="inlinecode"><span class="id" title="var">n</span></span>, so we are stuck. 
<div class="paragraph"> </div>

 But the proof goes through if we do not <span class="inlinecode"><span class="id" title="tactic">intros</span></span> <span class="inlinecode"><span class="id" title="var">m</span></span> in the beginning. 
</div>
<div class="code">
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">add_comm</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">n</span> <span class="id" title="var">m</span>, <span class="id" title="var">n</span> + <span class="id" title="var">m</span> = <span class="id" title="var">m</span> + <span class="id" title="var">n</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">n</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">induction</span> <span class="id" title="var">m</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">destruct</span> <span class="id" title="var">IHm</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">induction</span> <span class="id" title="var">m</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">IHm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHn</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
In the proof above, the context just before the second <span class="inlinecode"><span class="id" title="tactic">induction</span></span> <span class="inlinecode"><span class="id" title="var">m</span></span>
    contains <span class="inlinecode"><span class="id" title="var">IHn</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="keyword">∀</span></span> <span class="inlinecode"><span class="id" title="var">m</span>,</span> <span class="inlinecode"><span class="id" title="var">n</span></span> <span class="inlinecode">+</span> <span class="inlinecode"><span class="id" title="var">m</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">m</span></span> <span class="inlinecode">+</span> <span class="inlinecode"><span class="id" title="var">n</span></span>. Since <span class="inlinecode"><span class="id" title="var">m</span></span> does not appear free in this
    hypothesis, <span class="inlinecode"><span class="id" title="tactic">induction</span></span> can generate the motive
    <span class="inlinecode"><span class="id" title="var">P</span></span> <span class="inlinecode"><span class="id" title="var">m</span></span> <span class="inlinecode">:=</span> <span class="inlinecode"><span class="id" title="var">S</span></span> <span class="inlinecode"><span class="id" title="var">n</span></span> <span class="inlinecode">+</span> <span class="inlinecode"><span class="id" title="var">m</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">m</span></span> <span class="inlinecode">+</span> <span class="inlinecode"><span class="id" title="var">S</span></span> <span class="inlinecode"><span class="id" title="var">n</span></span>. 
<div class="paragraph"> </div>

 Addition is associative. 
</div>
<div class="code">
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">add_assoc</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span> <span class="id" title="var">c</span>, (<span class="id" title="var">a</span> + <span class="id" title="var">b</span>) + <span class="id" title="var">c</span> = <span class="id" title="var">a</span> + (<span class="id" title="var">b</span> + <span class="id" title="var">c</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span> <span class="id" title="var">c</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">a</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">destruct</span> <span class="id" title="var">IHa</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab2"></a><h1 class="section">Lists and their induction principle</h1>
 For simplicity, let us consider lists of <span class="inlinecode"><span class="id" title="var">nat</span></span>s. 
</div>
<div class="code">
<span class="id" title="keyword">Inductive</span> <span class="id" title="var">nat_list</span> : <span class="id" title="keyword">Set</span> :=<br/>
| <span class="id" title="var">nil</span> : <span class="id" title="var">nat_list</span><br/>
| <span class="id" title="var">cons</span> : <span class="id" title="var">nat</span> → <span class="id" title="var">nat_list</span> → <span class="id" title="var">nat_list</span>.<br/>

<br/>
</div>

<div class="doc">
Lists are inductively constructed by two constructors: <span class="inlinecode"><span class="id" title="var">nil</span></span> and <span class="inlinecode"><span class="id" title="var">cons</span></span>.
    So, to eliminate out of a list, it suffices to specify an action on <span class="inlinecode"><span class="id" title="var">nil</span></span>
    and an action on <span class="inlinecode"><span class="id" title="var">cons</span></span> <span class="inlinecode"><span class="id" title="var">n</span></span> <span class="inlinecode"><span class="id" title="var">l</span></span>. 
</div>
<div class="code">
<span class="id" title="keyword">Check</span> <span class="id" title="var">nat_list_ind</span>.<br/>
<span class="comment">(*&nbsp;<span class="inlinecode"><span class="id" title="var">nat_list_ind</span></span>
     <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="keyword">∀</span></span> <span class="inlinecode"><span class="id" title="var">P</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">nat_list</span></span> <span class="inlinecode">→</span> <span class="inlinecode"><span class="id" title="keyword">Prop</span>,</span>
       <span class="inlinecode"><span class="id" title="var">P</span></span> <span class="inlinecode"><span class="id" title="var">nil</span></span> <span class="inlinecode">→</span>
       <span class="inlinecode">(<span class="id" title="keyword">∀</span></span> <span class="inlinecode">(<span class="id" title="var">n</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">nat</span>)</span> <span class="inlinecode">(<span class="id" title="var">n0</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">nat_list</span>),</span> <span class="inlinecode"><span class="id" title="var">P</span></span> <span class="inlinecode"><span class="id" title="var">n0</span></span> <span class="inlinecode">→</span> <span class="inlinecode"><span class="id" title="var">P</span></span> <span class="inlinecode">(<span class="id" title="var">cons</span></span> <span class="inlinecode"><span class="id" title="var">n</span></span> <span class="inlinecode"><span class="id" title="var">n0</span>))</span> <span class="inlinecode">→</span>
       <span class="inlinecode"><span class="id" title="keyword">∀</span></span> <span class="inlinecode"><span class="id" title="var">n</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">nat_list</span>,</span> <span class="inlinecode"><span class="id" title="var">P</span></span> <span class="inlinecode"><span class="id" title="var">n</span></span>&nbsp;*)</span><br/>

<br/>
</div>

<div class="doc">
We can define operations on <span class="inlinecode"><span class="id" title="var">nat_list</span></span> by recursion. 
<div class="paragraph"> </div>

 <span class="inlinecode"><span class="id" title="var">length</span></span> <span class="inlinecode"><span class="id" title="var">l</span></span> is the length of <span class="inlinecode"><span class="id" title="var">l</span></span>. 
</div>
<div class="code">
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">length</span> (<span class="id" title="var">l</span> : <span class="id" title="var">nat_list</span>) : <span class="id" title="var">nat</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">l</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">nil</span> ⇒ 0<br/>
&nbsp;&nbsp;| <span class="id" title="var">cons</span> <span class="id" title="var">_</span> <span class="id" title="var">l</span> ⇒ <span class="id" title="var">S</span> (<span class="id" title="var">length</span> <span class="id" title="var">l</span>)<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
<span class="inlinecode"><span class="id" title="var">concate</span></span> <span class="inlinecode"><span class="id" title="var">l</span></span> <span class="inlinecode"><span class="id" title="var">s</span></span> is the concatenation of <span class="inlinecode"><span class="id" title="var">l</span></span> and <span class="inlinecode"><span class="id" title="var">s</span></span>. 
</div>
<div class="code">
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">concate</span> (<span class="id" title="var">l</span> <span class="id" title="var">s</span> : <span class="id" title="var">nat_list</span>) : <span class="id" title="var">nat_list</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">l</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">nil</span> ⇒ <span class="id" title="var">s</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">cons</span> <span class="id" title="var">a</span> <span class="id" title="var">l</span> ⇒ <span class="id" title="var">cons</span> <span class="id" title="var">a</span> (<span class="id" title="var">concate</span> <span class="id" title="var">l</span> <span class="id" title="var">s</span>)<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
<span class="inlinecode"><span class="id" title="var">reverse</span></span> <span class="inlinecode"><span class="id" title="var">l</span></span> is the reversal of <span class="inlinecode"><span class="id" title="var">l</span></span>. 
</div>
<div class="code">
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">reverse</span> (<span class="id" title="var">l</span> : <span class="id" title="var">nat_list</span>) : <span class="id" title="var">nat_list</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">l</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">nil</span> ⇒ <span class="id" title="var">nil</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">cons</span> <span class="id" title="var">a</span> <span class="id" title="var">l</span> ⇒ <span class="id" title="var">concate</span> (<span class="id" title="var">reverse</span> <span class="id" title="var">l</span>) (<span class="id" title="var">cons</span> <span class="id" title="var">a</span> <span class="id" title="var">nil</span>)<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
<span class="inlinecode"><span class="id" title="var">length</span></span> commutes with <span class="inlinecode"><span class="id" title="var">concate</span></span> with respect to <span class="inlinecode">+</span>. 
</div>
<div class="code">
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">length_comm_concate</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">l</span> <span class="id" title="var">s</span>, <span class="id" title="var">length</span> (<span class="id" title="var">concate</span> <span class="id" title="var">l</span> <span class="id" title="var">s</span>) = <span class="id" title="var">length</span> <span class="id" title="var">l</span> + <span class="id" title="var">length</span> <span class="id" title="var">s</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">l</span> <span class="id" title="var">s</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">l</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">destruct</span> <span class="id" title="var">IHl</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<span class="inlinecode"><span class="id" title="var">reverse</span></span> preserves <span class="inlinecode"><span class="id" title="var">length</span></span>. 
</div>
<div class="code">
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">reverse_pre_length</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">l</span>, <span class="id" title="var">length</span> (<span class="id" title="var">reverse</span> <span class="id" title="var">l</span>) = <span class="id" title="var">length</span> <span class="id" title="var">l</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">l</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">length_comm_concate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">IHl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">lia</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<span class="inlinecode"><span class="id" title="var">nil</span></span> is the right identity w.r.t. <span class="inlinecode"><span class="id" title="var">concate</span></span>. 
</div>
<div class="code">
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">concate_nil</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">l</span>, <span class="id" title="var">concate</span> <span class="id" title="var">l</span> <span class="id" title="var">nil</span> = <span class="id" title="var">l</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">l</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHl</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<span class="inlinecode"><span class="id" title="var">reverse</span></span> is identity on singletons. 
</div>
<div class="code">
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">reverse_id_singleton</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">n</span>, <span class="id" title="var">reverse</span> (<span class="id" title="var">cons</span> <span class="id" title="var">n</span> <span class="id" title="var">nil</span>) = <span class="id" title="var">cons</span> <span class="id" title="var">n</span> <span class="id" title="var">nil</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">easy</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<span class="inlinecode"><span class="id" title="var">concate</span></span> is associative. 
</div>
<div class="code">
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">concate_assoc</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">l</span> <span class="id" title="var">s</span> <span class="id" title="var">t</span>, <span class="id" title="var">concate</span> (<span class="id" title="var">concate</span> <span class="id" title="var">l</span> <span class="id" title="var">s</span>) <span class="id" title="var">t</span> = <span class="id" title="var">concate</span> <span class="id" title="var">l</span> (<span class="id" title="var">concate</span> <span class="id" title="var">s</span> <span class="id" title="var">t</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">l</span> <span class="id" title="var">s</span> <span class="id" title="var">t</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">l</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">destruct</span> <span class="id" title="var">IHl</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<span class="inlinecode"><span class="id" title="var">reverse</span></span> commutes with <span class="inlinecode"><span class="id" title="var">concate</span></span>. 
</div>
<div class="code">
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">reverse_comm_concate</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">l</span> <span class="id" title="var">s</span>, <span class="id" title="var">reverse</span> (<span class="id" title="var">concate</span> <span class="id" title="var">l</span> <span class="id" title="var">s</span>) = <span class="id" title="var">concate</span> (<span class="id" title="var">reverse</span> <span class="id" title="var">s</span>) (<span class="id" title="var">reverse</span> <span class="id" title="var">l</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">l</span> <span class="id" title="var">s</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">l</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">concate_nil</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">concate_assoc</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<span class="inlinecode"><span class="id" title="var">reverse</span></span> is involutative. 
</div>
<div class="code">
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">reverse_invol</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">l</span>, <span class="id" title="var">reverse</span> (<span class="id" title="var">reverse</span> <span class="id" title="var">l</span>) = <span class="id" title="var">l</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">l</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">reverse_comm_concate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHl</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<span class="inlinecode"><span class="id" title="var">reverse</span></span> is injective. 
</div>
<div class="code">
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">reverse_inj</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">l</span> <span class="id" title="var">s</span>, <span class="id" title="var">reverse</span> <span class="id" title="var">l</span> = <span class="id" title="var">reverse</span> <span class="id" title="var">s</span> → <span class="id" title="var">l</span> = <span class="id" title="var">s</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">l</span> <span class="id" title="var">s</span> <span class="id" title="var">eq</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">eq'</span> : <span class="id" title="var">reverse</span> (<span class="id" title="var">reverse</span> <span class="id" title="var">l</span>) = <span class="id" title="var">reverse</span> (<span class="id" title="var">reverse</span> <span class="id" title="var">s</span>)). {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">destruct</span> <span class="id" title="var">eq</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">reverse_invol</span> <span class="id" title="tactic">in</span> <span class="id" title="var">eq'</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">easy</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<span class="inlinecode"><span class="id" title="var">concate</span></span> is injective in the second argument. 
</div>
<div class="code">
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">concate_inj_second</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">l</span> <span class="id" title="var">s1</span> <span class="id" title="var">s2</span>, <span class="id" title="var">concate</span> <span class="id" title="var">l</span> <span class="id" title="var">s1</span> = <span class="id" title="var">concate</span> <span class="id" title="var">l</span> <span class="id" title="var">s2</span> → <span class="id" title="var">s1</span> = <span class="id" title="var">s2</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">l</span> <span class="id" title="var">s1</span> <span class="id" title="var">s2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">l</span>; <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> *; <span class="id" title="tactic">intros</span> <span class="id" title="var">eq</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">inversion</span> <span class="id" title="var">eq</span>; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <span class="id" title="var">IHl</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<span class="inlinecode"><span class="id" title="var">concate</span></span> is also injective in the first argument. This is a corollary of
    <span class="inlinecode"><span class="id" title="var">concate_inj_second</span></span>. 
</div>
<div class="code">
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">concate_inj_first</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">l1</span> <span class="id" title="var">l2</span> <span class="id" title="var">s</span>, <span class="id" title="var">concate</span> <span class="id" title="var">l1</span> <span class="id" title="var">s</span> = <span class="id" title="var">concate</span> <span class="id" title="var">l2</span> <span class="id" title="var">s</span> → <span class="id" title="var">l1</span> = <span class="id" title="var">l2</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">l1</span> <span class="id" title="var">l2</span> <span class="id" title="var">s</span> <span class="id" title="var">eq</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">eq'</span> : <span class="id" title="var">reverse</span> (<span class="id" title="var">concate</span> <span class="id" title="var">l1</span> <span class="id" title="var">s</span>) = <span class="id" title="var">reverse</span> (<span class="id" title="var">concate</span> <span class="id" title="var">l2</span> <span class="id" title="var">s</span>)). {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">eq</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="id" title="tactic">clear</span> <span class="id" title="var">eq</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">reverse_comm_concate</span> <span class="id" title="tactic">in</span> <span class="id" title="var">eq'</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">concate_inj_second</span> <span class="id" title="tactic">in</span> <span class="id" title="var">eq'</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">reverse_inj</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">easy</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
A list is said to be a <i>palindrome</i> if it equals its own reversal. 
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <span class="id" title="var">palindrome</span> (<span class="id" title="var">l</span> : <span class="id" title="var">nat_list</span>) : <span class="id" title="keyword">Prop</span> := <span class="id" title="var">l</span> = <span class="id" title="var">reverse</span> <span class="id" title="var">l</span>.<br/>

<br/>
</div>

<div class="doc">
The empty list is a palindrome. 
</div>
<div class="code">
<span class="id" title="keyword">Example</span> <span class="id" title="var">palindrome_nil</span> : <span class="id" title="var">palindrome</span> <span class="id" title="var">nil</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">easy</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Singleton lists are palindromes. 
</div>
<div class="code">
<span class="id" title="keyword">Example</span> <span class="id" title="var">palindrome_single</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">n</span>, <span class="id" title="var">palindrome</span> (<span class="id" title="var">cons</span> <span class="id" title="var">n</span> <span class="id" title="var">nil</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">easy</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
We can equivalently express <span class="inlinecode"><span class="id" title="var">palindrome</span></span> as an inductively defined relation.
    Each constructor specifies a canonical proof of this relation. 
</div>
<div class="code">
<span class="id" title="keyword">Inductive</span> <span class="id" title="var">palindrome'</span> : <span class="id" title="var">nat_list</span> → <span class="id" title="keyword">Prop</span> :=<br/>
| <span class="id" title="var">pal_nil</span> : <span class="id" title="var">palindrome'</span> <span class="id" title="var">nil</span><br/>
| <span class="id" title="var">pal_single</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">n</span>, <span class="id" title="var">palindrome'</span> (<span class="id" title="var">cons</span> <span class="id" title="var">n</span> <span class="id" title="var">nil</span>)<br/>
| <span class="id" title="var">pal_more</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">n</span> <span class="id" title="var">l</span>, <span class="id" title="var">palindrome'</span> <span class="id" title="var">l</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">palindrome'</span> (<span class="id" title="var">cons</span> <span class="id" title="var">n</span> (<span class="id" title="var">concate</span> <span class="id" title="var">l</span> (<span class="id" title="var">cons</span> <span class="id" title="var">n</span> <span class="id" title="var">nil</span>))).<br/>

<br/>
</div>

<div class="doc">
<span class="inlinecode"><span class="id" title="var">palindrome'</span></span> is sound. The proof is a simple induction on the derivation of
    <span class="inlinecode"><span class="id" title="var">palindrome'</span></span> <span class="inlinecode"><span class="id" title="var">l</span></span>. 
</div>
<div class="code">
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">palindrome'_sound</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">l</span>, <span class="id" title="var">palindrome'</span> <span class="id" title="var">l</span> → <span class="id" title="var">palindrome</span> <span class="id" title="var">l</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">l</span> <span class="id" title="var">pal</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">pal</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">palindrome_nil</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">palindrome_single</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">unfold</span> <span class="id" title="var">palindrome</span> <span class="id" title="tactic">in</span> ×.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">reverse_comm_concate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">IHpal</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">reverse_id_singleton</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
This technical lemma allows us to extract the middle part of a
    palindrome. 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">palindrome_inversion</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">n</span> <span class="id" title="var">l</span>, <span class="id" title="var">palindrome</span> (<span class="id" title="var">cons</span> <span class="id" title="var">n</span> <span class="id" title="var">l</span>) →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">l</span> ≠ <span class="id" title="var">nil</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">∃</span> <span class="id" title="var">l'</span>, <span class="id" title="var">l</span> = <span class="id" title="var">reverse</span> (<span class="id" title="var">cons</span> <span class="id" title="var">n</span> <span class="id" title="var">l'</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">n</span> <span class="id" title="var">l</span> <span class="id" title="var">pal</span> <span class="id" title="var">neq</span>; <span class="id" title="tactic">unfold</span> <span class="id" title="var">palindrome</span> <span class="id" title="tactic">in</span> <span class="id" title="var">pal</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">reverse</span> <span class="id" title="var">l</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">eq</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="var">exfalso</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">neq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- (<span class="id" title="var">reverse_invol</span> <span class="id" title="var">l</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">eq</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">clear</span> <span class="id" title="var">neq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rename</span> <span class="id" title="var">n1</span> <span class="id" title="var">into</span> <span class="id" title="var">l1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">pal</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">eq</span> <span class="id" title="tactic">in</span> <span class="id" title="var">pal</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">pal</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">pal</span>; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">clear</span> <span class="id" title="var">pal</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">∃</span> (<span class="id" title="var">reverse</span> <span class="id" title="var">l1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">reverse_invol</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Completeness is a lot harder to prove. A straightforward induction on <span class="inlinecode"><span class="id" title="var">l</span></span>
    (or <span class="inlinecode"><span class="id" title="var">length</span></span> <span class="inlinecode"><span class="id" title="var">l</span></span>) fails. An intuitive explanation is that, to use <span class="inlinecode"><span class="id" title="var">pal_more</span></span>,
    we need to look at a list with 2 less elements, but the induction hypothesis
    is not strong enough to accomplish this. 
<div class="paragraph"> </div>

 To resolve this issue, we can introduce a "fuel" variable and show that
    <span class="inlinecode"><span class="id" title="var">palindrome'</span></span> is complete for any amount of fuel. 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">palindrome'_complete_fuel</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">m</span> <span class="id" title="var">l</span>, <span class="id" title="var">length</span> <span class="id" title="var">l</span> &lt; <span class="id" title="var">m</span> → <span class="id" title="var">palindrome</span> <span class="id" title="var">l</span> → <span class="id" title="var">palindrome'</span> <span class="id" title="var">l</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">m</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">l</span> <span class="id" title="var">lt</span> <span class="id" title="var">pal</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">destruct</span> <span class="id" title="var">l</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">lt</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">destruct</span> <span class="id" title="var">l</span>; [| <span class="id" title="tactic">destruct</span> <span class="id" title="var">l</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">apply</span> <span class="id" title="var">palindrome_inversion</span> <span class="id" title="tactic">in</span> <span class="id" title="var">pal</span> <span class="id" title="keyword">as</span> <span class="id" title="var">h</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">h</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">l'</span> <span class="id" title="var">eq</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">palindrome</span> <span class="id" title="tactic">in</span> <span class="id" title="var">pal</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">symmetry</span> <span class="id" title="tactic">in</span> <span class="id" title="var">eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">pal</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">reverse_id_singleton</span> <span class="id" title="tactic">in</span> <span class="id" title="var">pal</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">reverse_comm_concate</span> <span class="id" title="tactic">in</span> <span class="id" title="var">pal</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">reverse_invol</span> <span class="id" title="tactic">in</span> <span class="id" title="var">pal</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">pal</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">pal</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">eq</span>]; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">concate_inj_first</span> <span class="id" title="tactic">in</span> <span class="id" title="var">eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IHm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">rewrite</span> <span class="id" title="var">reverse_pre_length</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">lt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">length_comm_concate</span> <span class="id" title="tactic">in</span> <span class="id" title="var">lt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">reverse_pre_length</span> <span class="id" title="tactic">in</span> <span class="id" title="var">lt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="var">easy</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Now, completeness is an immediate corollary of
    <span class="inlinecode"><span class="id" title="var">palindrome'_complete_fuel</span></span>. 
</div>
<div class="code">
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">palindrome'_complete</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">l</span>, <span class="id" title="var">palindrome</span> <span class="id" title="var">l</span> → <span class="id" title="var">palindrome'</span> <span class="id" title="var">l</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">l</span> <span class="id" title="var">pal</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">palindrome'_complete_fuel</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">m</span> := <span class="id" title="var">S</span> (<span class="id" title="var">length</span> <span class="id" title="var">l</span>)).<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">constructor</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="var">easy</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab3"></a><h1 class="section">Well-founded induction</h1>

<div class="paragraph"> </div>

 We can generalize the "fuel" technique. An inhabitant <span class="inlinecode"><span class="id" title="var">x</span></span> is said to be
    <i>accessible</i> (w.r.t. a relation <span class="inlinecode"><span class="id" title="var">R</span></span>) if for all <span class="inlinecode"><span class="id" title="var">y</span></span> with <span class="inlinecode"><span class="id" title="var">y</span></span> <span class="inlinecode"><span class="id" title="var">R</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span>, <span class="inlinecode"><span class="id" title="var">y</span></span> is
    accessible. 
</div>
<div class="code">
<span class="id" title="keyword">Inductive</span> <span class="id" title="var">acc</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} {<span class="id" title="var">R</span> : <span class="id" title="var">A</span> → <span class="id" title="var">A</span> → <span class="id" title="keyword">Prop</span>} : <span class="id" title="var">A</span> → <span class="id" title="keyword">Prop</span> :=<br/>
| <span class="id" title="var">acc_k</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">x</span>, (<span class="id" title="keyword">∀</span> <span class="id" title="var">y</span>, <span class="id" title="var">R</span> <span class="id" title="var">y</span> <span class="id" title="var">x</span> → <span class="id" title="var">acc</span> <span class="id" title="var">y</span>) → <span class="id" title="var">acc</span> <span class="id" title="var">x</span>.<br/>

<br/>
</div>

<div class="doc">
A relation is said to be <i>well-founded</i> if every inhabitant is
    accessible. 
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <span class="id" title="keyword">wf</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">R</span> : <span class="id" title="var">A</span> → <span class="id" title="var">A</span> → <span class="id" title="keyword">Prop</span>) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">x</span>, @<span class="id" title="var">acc</span> <span class="id" title="var">A</span> <span class="id" title="var">R</span> <span class="id" title="var">x</span>.<br/>

<br/>
</div>

<div class="doc">
We can now define well-founded induction. 
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <span class="id" title="var">wf_ind</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} {<span class="id" title="var">R</span> : <span class="id" title="var">A</span> → <span class="id" title="var">A</span> → <span class="id" title="keyword">Prop</span>} (<span class="id" title="var">P</span> : <span class="id" title="var">A</span> → <span class="id" title="keyword">Prop</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">wf</span> <span class="id" title="var">R</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">∀</span> <span class="id" title="var">x</span>, (<span class="id" title="keyword">∀</span> <span class="id" title="var">y</span>, <span class="id" title="var">R</span> <span class="id" title="var">y</span> <span class="id" title="var">x</span> → <span class="id" title="var">P</span> <span class="id" title="var">y</span>) → <span class="id" title="var">P</span> <span class="id" title="var">x</span>) →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">x</span>, <span class="id" title="var">P</span> <span class="id" title="var">x</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">A</span> <span class="id" title="var">R</span> <span class="id" title="var">P</span> <span class="id" title="keyword">wf</span> <span class="id" title="var">f</span> <span class="id" title="var">x</span> ⇒ <span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<span class="id" title="var">acc_ind</span> <span class="id" title="var">A</span> <span class="id" title="var">R</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> (<span class="id" title="keyword">wf</span> <span class="id" title="var">x</span>)).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">g</span> ⇒ <span class="id" title="var">f</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">y</span> <span class="id" title="var">r</span> ⇒ <span class="id" title="var">g</span> <span class="id" title="var">_</span> <span class="id" title="var">r</span>).<br/>
<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
<span class="inlinecode">&lt;</span> is well-founded. 
</div>
<div class="code">
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">wf_lt</span> : <span class="id" title="keyword">wf</span> <span class="id" title="var">lt</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="keyword">wf</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">x</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">y</span> <span class="id" title="var">lt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">lt</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">induction</span> <span class="id" title="var">IHx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">y</span> <span class="id" title="var">lt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">y2</span> <span class="id" title="var">lt2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">y3</span> <span class="id" title="var">lt3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">lia</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Strong induction is a special case of <span class="inlinecode"><span class="id" title="var">wf_ind</span></span>. 
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <span class="id" title="var">strong_ind</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> (<span class="id" title="var">P</span> : <span class="id" title="var">nat</span> → <span class="id" title="keyword">Prop</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">∀</span> <span class="id" title="var">x</span>, (<span class="id" title="keyword">∀</span> <span class="id" title="var">y</span>, <span class="id" title="var">y</span> &lt; <span class="id" title="var">x</span> → <span class="id" title="var">P</span> <span class="id" title="var">y</span>) → <span class="id" title="var">P</span> <span class="id" title="var">x</span>) →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">x</span>, <span class="id" title="var">P</span> <span class="id" title="var">x</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">exact</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">P</span> ⇒ @<span class="id" title="var">wf_ind</span> <span class="id" title="var">nat</span> <span class="id" title="var">lt</span> <span class="id" title="var">P</span> <span class="id" title="var">wf_lt</span>).<br/>
<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
We can define a well-founded relation on lists. 
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <span class="id" title="var">R</span> (<span class="id" title="var">l</span> <span class="id" title="var">l'</span> : <span class="id" title="var">nat_list</span>) : <span class="id" title="keyword">Prop</span> := <span class="id" title="var">length</span> <span class="id" title="var">l</span> &lt; <span class="id" title="var">length</span> <span class="id" title="var">l'</span>.<br/>

<br/>
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">wf_R</span> : <span class="id" title="keyword">wf</span> <span class="id" title="var">R</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="keyword">wf</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">x</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">y</span> <span class="id" title="var">r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">r</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">induction</span> <span class="id" title="var">IHx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">y</span> <span class="id" title="var">r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">y0</span> <span class="id" title="var">r0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">R</span> <span class="id" title="tactic">in</span> ×.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">lia</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
We can now do strong induction on lists. 
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <span class="id" title="var">strong_list_ind</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> (<span class="id" title="var">P</span> : <span class="id" title="var">nat_list</span> → <span class="id" title="keyword">Prop</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">∀</span> <span class="id" title="var">x</span>, (<span class="id" title="keyword">∀</span> <span class="id" title="var">y</span>, <span class="id" title="var">R</span> <span class="id" title="var">y</span> <span class="id" title="var">x</span> → <span class="id" title="var">P</span> <span class="id" title="var">y</span>) → <span class="id" title="var">P</span> <span class="id" title="var">x</span>) →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">x</span>, <span class="id" title="var">P</span> <span class="id" title="var">x</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">exact</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">P</span> ⇒ @<span class="id" title="var">wf_ind</span> <span class="id" title="var">nat_list</span> <span class="id" title="var">R</span> <span class="id" title="var">P</span> <span class="id" title="var">wf_R</span>).<br/>
<span class="id" title="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
We can use <span class="inlinecode"><span class="id" title="var">strong_list_ind</span></span> to prove <span class="inlinecode"><span class="id" title="var">palindrome'_complete</span></span>. The proof is
    essentially the same. 
</div>
<div class="code">
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">palindrome'_complete_strong</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">l</span>, <span class="id" title="var">palindrome</span> <span class="id" title="var">l</span> → <span class="id" title="var">palindrome'</span> <span class="id" title="var">l</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">l</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">l</span> <span class="id" title="var">f</span>] <span class="id" title="keyword">using</span> <span class="id" title="var">strong_list_ind</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">pal</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">l</span>; [| <span class="id" title="tactic">destruct</span> <span class="id" title="var">l</span>].<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">constructor</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">constructor</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">palindrome_inversion</span> <span class="id" title="tactic">in</span> <span class="id" title="var">pal</span> <span class="id" title="keyword">as</span> <span class="id" title="var">h</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">h</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">l'</span> <span class="id" title="var">eq</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">palindrome</span> <span class="id" title="tactic">in</span> <span class="id" title="var">pal</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">symmetry</span> <span class="id" title="tactic">in</span> <span class="id" title="var">eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">pal</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">reverse_id_singleton</span> <span class="id" title="tactic">in</span> <span class="id" title="var">pal</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">reverse_comm_concate</span> <span class="id" title="tactic">in</span> <span class="id" title="var">pal</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">reverse_invol</span> <span class="id" title="tactic">in</span> <span class="id" title="var">pal</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">pal</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">pal</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">eq</span>]; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">concate_inj_first</span> <span class="id" title="tactic">in</span> <span class="id" title="var">eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">f</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">unfold</span> <span class="id" title="var">R</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">length_comm_concate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">reverse_pre_length</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="var">easy</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">End</span> <span class="id" title="keyword">Induction</span>.<br/>
</div>
</div>

<div id="footer">
<hr/><a href="index.html">Index</a><hr/>This page has been generated by <a href="http://coq.inria.fr/">coqdoc</a>
</div>

</div>

</body>
</html>
